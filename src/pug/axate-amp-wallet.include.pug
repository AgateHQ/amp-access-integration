//- Axate Debug
div(amp-access='NOT error AND loggedIn')
  template(amp-access-template, type='amp-mustache')
    div(data-axate-debug='messages')
      p(data-axate-debug='msg') Gauge
      | {{#isGaugeEmpty}}
      p(data-axate-debug='msg') isEmpty
      | {{/isGaugeEmpty}}
      | {{#isGaugeFull}}
      p(data-axate-debug='msg') isFull
      | {{/isGaugeFull}}
      | {{#isGaugeStateOne}}
      p(data-axate-debug='msg') isStateOne
      | {{/isGaugeStateOne}}
      | {{#isGaugeStateTwo}}
      p(data-axate-debug='msg') isStateTwo
      | {{/isGaugeStateTwo}}

//- Axate AMP - Component - Wallet Handle
div.axate__wallet-handle
  div(amp-access='NOT error')
    template(amp-access-template, type='amp-mustache')
      | {{^notice}}
      a.axate-amp__status__default(href='#axate')
      | {{/notice}}
      | {{#notice}}
      | {{#type}}
      | {{^is_insuf_balance}}
      a.axate-amp__status__default(href='#axate')
      | {{/is_insuf_balance}}
      | {{#is_insuf_balance}}
      a.axate-amp__status__balance-low(href='#axate')
      | {{/is_insuf_balance}}
      | {{/type}}
      | {{/notice}}
    div(amp-access='error')
      template(amp-access-template, type='amp-mustache')
        a.axate-amp__status__error(href='#axate', amp-access='error')

div(id='axate')
  div.axate-amp__container(amp-access='NOT error AND NOT loggedIn')
    template(amp-access-template, type='amp-mustache')
      main.axate-amp__notice
        p.
          Help us to keep reporting on the issues that matter to you with Axate’s pay-per-article digital wallet.
        p.
          Just create a wallet with our payment partner Agate and you'll be good to go.
          Pay {{publisher.article_cost}} per article, no more that {{publisher.cap_cost}} per week
        button.axate-amp__button(on='tap:amp-access.login-sign-up', role='button').
          Pay per article
        footer
          p.
            Already have an account? #[a(on='tap:amp-access.login-sign-in') Login here].

a.axate-amp__article-link(href='#') Jump to article



div(amp-access='NOT error AND loggedIn')
  template(amp-access-template, type='amp-mustache')
    | {{#isNotice}}
    main.axate-amp__notice
      | {{#notice}}
      h5.axate-amp__notice__logo Axate
      h2 {{title}}
      p {{description}}
        | {{#type}}
        | {{#is_amount_gt_threshold}}
        div.axate-amp__notice-text
          h5 You have chosen to authorise every charge
          p.axate-amp__notice-threshold.
            This article is {{publisher.article_cost}} but you will never pay more than {{publisher.cap_cost}} per week for {{publicationName}}.
          div.axate-amp__toggle-container
            p.axate-amp__toggle-text
              span Charge me automatically
            input.axate-amp__toggle-checkbox(id='authorise-charge' type='checkbox')
            label.axate-amp__toggle-label(for='authorise-charge')
            div.axate-amp__toggle-button-container
              button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-unchecked', role='button' on='tap:amp-access.login-authorise-charge-true', title='Autocharge = OFF') Continue Reading
              button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-checked', role='button' on='tap:amp-access.login-authorise-charge-false', title='Autocharge = ON') Continue Reading
          | {{/is_amount_gt_threshold}}
          | {{#is_insuf_balance}}
          code Insufficient Balance Warning/Notice
          | {{/is_insuf_balance}}
          | {{#is_new_pricing}}
          code Updated Publication Pricing
          | {{/is_new_pricing}}
          //- Begin: Reader is new to Axate and this publication
          | {{#is_new_publication}}
          div.axate-amp__notice-text
          div.axate-amp__toggle-container
          p.axate-amp__toggle-text
            span Charge me automatically for {{publisher.name}} from now on
            input.axate-amp__toggle-checkbox(id='set-threshold-toggle', type='checkbox', checked)
            label.axate-amp__toggle-label(for='set-threshold-toggle')
            div.axate-amp__toggle-button-container
              button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-checked', role='button', on='tap:amp-access.login-set-threshold-yes' title='Autocharge = ON') Confirm &amp; Continue Reading for {{publisher.article_cost}}
            button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-unchecked', role='button' on='tap:amp-access.login-set-threshold-no' title='Autocharge = OFF') Confirm &amp; Continue Reading for {{publisher.article_cost}}
          | {{/is_new_publication}}
          | {{#is_show_finish_no_funds_notice}}
          button.axate-amp__button.axate-amp__button--thin(on='tap:amp-access.login-top-up', role='button') Add funds
          small {{publicationName}} is published independently of Axate.
          | {{/is_show_finish_no_funds_notice}}
          | {{#is_show_finish_notice}}
          div.axate-amp__notice-text axate-amp__notice-bold
            h5 Tap OK to pay {{publisher.article_cost}}
            p You’ll never pay more than {{publisher.cap_cost}} per week for {{publisher.name}}.
            p Do you want to approve all charges on this site?
            div.axate-amp__toggle-container axate-amp__notice-bold
            p.axate-amp__toggle-text
              strong Yes, charge me automatically
              br
              span Switch off to approve each charge
            input.axate-amp__toggle-checkbox(id='set-threshold-toggle' type='checkbox', checked)
            label.axate-amp__toggle-label(for='set-threshold-toggle')
            div.axate-amp__toggle-button-container
              button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-checked', role='button' on='tap:amp-access.login-set-threshold-yes', title='OK - Yes, charge me automatically') OK
              button.axate-amp__button.axate-amp__button--thin(data-axate-action='toggle-unchecked', role='button' on='tap:amp-access.login-set-threshold-no', title='OK - No, I would like to manually authorise charges') OK
            small {{publicationName}} is published independently of Axate.
          | {{/is_show_finish_notice}}
          | {{#on_subscription}}
          code On Subscription
          | {{/on_subscription}}
        | {{/type}}
      | {{/notice}}
    | {{/isNotice}}




  //- Axate AMP - Component - Wallet
  section.axate-amp__container(amp-access='NOT error AND loggedIn')
    template(amp-access-template, type='amp-mustache')
      | {{#wallet}}
      //- Wallet flipper
      label(for='axate-amp__wallet-flip')
      input.axate-amp__wallet-flipper(id='axate-amp__wallet-flip', type='checkbox')
      //- End Wallet flipper
      section.axate-amp__wallet

        //- Front of wallet
        section.axate-amp__flip-face.axate-amp__front
          header.axate-amp__header
            div.axate-amp__balance
              div(amp-access='NOT error AND loggedIn')
                h4.amp-access-axate-logo__container Axate
                div.axate-amp__balance__container
                  span.axate-amp__balance__amount {{wallet.balance}}
                  span.axate-amp__balance__subtitle.
                    Total balance
              button.axate-amp__button.axate-amp__button--thin(on='tap:amp-access.login-top-up', role='button').
                Top up
              main.axate-amp__main
                div.axate-amp__information
                  div.axate-pricing-container
                    p.axate-pricing-per-article
                      strong {{publisher.article_cost}}
                      span per article
                    p.axate-pricing-per-week
                      strong {{publisher.cap_cost}}
                      span free point/per week
                  div.axate-gauge-container
                    svg.axate-gauge(width='120', height='120', viewBox='0 0 120 120')
                      circle.axate-gauge-progress__meter(cx='60', cy='60', r='56', stroke-width='5')
                      circle.axate-gauge-progress__value(cx='60', cy='60', r='56', stroke-width='5', style='stroke-dasharray: 399.992; stroke-dashoffset: {{wallet.gaugeSVGStrokeDashOffset}};')
                    //- Gauge Text
                    | {{#isGaugeEmpty}}
                    p.axate-gauge-inner-text(title='isEmpty')
                      strong {{wallet.remainingUntilFree}}
                      span until free
                    | {{/isGaugeEmpty}}
                    | {{#isGaugeStateOne}}
                    p.axate-gauge-inner-text(title='isGaugeStateOne')
                      strong {{wallet.remainingUntilFree}}
                      span until free
                    | {{/isGaugeStateOne}}
                    | {{#isGaugeStateTwo}}
                    p.axate-gauge-inner-text(title='isGaugeStateTwo')
                      strong {{wallet.remainingUntilFree}}
                      span until free
                    | {{/isGaugeStateTwo}}
                    | {{#isGaugeFull}}
                    p.axate-gauge-inner-text
                      strong Free
                      span {{wallet.freeUntilDate}}
                    | {{/isGaugeFull}}

                footer
                | {{#warning}}
                section.axate-amp__warning
                  p.axate-amp__warning__text {{warning}}
                | {{/warning}}


        //-  Back of wallet
        section.axate-amp__flip-face.axate-amp__back
          header.axate-amp__header
            div.axate-amp__balance
              h4.amp-access-axate-logo__container Axate
              div.axate-amp__settings-panel
                ul
                  li.axate-amp__setting-icon__account
                    a(data-ui='button', title='Account', href='https://{{accountUrl}}/my-agate/account', target='_blank')
                      div
                      span Account
                  li.axate-amp__setting-icon__help
                    a(data-ui='button', title='Help', href='mailto:support@axate.com?subject=I have feedback or a question (My ID is: {{wallet.id}})')
                      div
                      span Help
                  li.axate-amp__setting-icon__feedback
                    a(data-ui='button', title='Feedback', href='mailto:support@axate.com?subject=Report a bug')
                      div
                      span Feedback
                  li.axate-amp__setting-icon__log-out
                    a(data-ui='button' title='Log out' href='#' on='tap:amp-access.login-sign-out')
                      div
                      span Log out
          main.axate-amp__main
            div.axate-amp__section_publication_name
              h3 {{publicationName}}
            div.axate-amp__section_cost
              p Free point/week:
              span.axate-amp__currency_amount {{publisher.cap_cost}}
              p.axate-amp__section_smalltext (updates on Mon Aug 12 2019)
              p.axate-amp__section_description.
                Once you spend {{publisher.cap_cost}} in a week your free reading continues until Mon Aug 12 2019.

      | {{/wallet}}


      footer.axate-amp__footer

        | {{#wallet}}
        a.axate-amp__footer__center(href='#') Go back to article
        | {{/wallet}}

    section.axate-amp__container(amp-access='error', amp-access-hide)
      section.axate-amp__warning
        p.axate-amp__warning__text.
          TODO - Improve this error message
        p.axate-amp__warning__text.
          Oops... Something broke.